<!DOCTYPE html>
<html>
<head>
<title>Artiva Biotherapeutics - Clinical Trial Sites</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }

/* Login styles */
body.login-mode {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}
#loginBox {
  background: white;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  width: 90%;
  max-width: 400px;
}
#loginBox h2 {
  margin-bottom: 10px;
  color: #333;
  font-size: 24px;
}
#loginBox p {
  color: #666;
  margin-bottom: 30px;
  font-size: 14px;
}
#loginBox input {
  width: 100%;
  padding: 12px 16px;
  margin-bottom: 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
}
#loginBox input:focus {
  outline: none;
  border-color: #667eea;
}
#loginBox button {
  width: 100%;
  padding: 12px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s;
}
#loginBox button:hover {
  background: #5568d3;
}
#error {
  color: #e74c3c;
  font-size: 13px;
  margin-top: 10px;
  display: none;
}

/* Dashboard styles */
body.dashboard-mode {
  background: #1a2332;
}
#dashboard {
  display: none;
}
body.dashboard-mode #dashboard {
  display: block;
}
body.dashboard-mode #loginBox {
  display: none;
}

#header {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  background: rgba(26,35,50,0.95);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  white-space: nowrap;
}
#header b { color: #3498db; }
#logout {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 11;
  background: rgba(231,76,60,0.9);
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  border: none;
}
#logout:hover { background: rgba(231,76,60,1); }
#viewToggle {
  position: fixed;
  top: 10px;
  right: 90px;
  z-index: 11;
  background: rgba(52,152,219,0.9);
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  border: none;
}
#viewToggle:hover { background: rgba(52,152,219,1); }
#map { width: 100vw; height: 100vh; }
svg { width: 100%; height: 100%; }
.land { fill: #2c3e50; stroke: #34495e; stroke-width: 0.5; }
.site { cursor: pointer; opacity: 0.85; }
.site:hover { opacity: 1; }
#tooltip {
  position: fixed;
  background: rgba(0,0,0,0.9);
  color: white;
  padding: 10px 14px;
  border-radius: 6px;
  font-size: 12px;
  pointer-events: none;
  display: none;
  z-index: 20;
  max-width: 300px;
  line-height: 1.5;
}
#legend {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(255,255,255,0.95);
  padding: 14px 18px;
  border-radius: 8px;
  font-size: 11px;
  z-index: 10;
  max-width: 300px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
#legend h4 { margin-bottom: 6px; font-size: 13px; }
.legend-item {
  margin: 4px 0;
}
.legend-color {
  width: 12px;
  height: 12px;
  display: inline-block;
  border-radius: 50%;
  margin-right: 6px;
}

/* Table view styles */
#tableView {
  display: none;
  padding: 80px 20px 20px 20px;
  max-width: 1400px;
  margin: 0 auto;
}
#tableView.active {
  display: block;
}
#map.hidden {
  display: none;
}
#legend.hidden {
  display: none;
}
.table-container {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.table-header {
  background: #2c3e50;
  color: white;
  padding: 20px;
  font-size: 18px;
  font-weight: 600;
}
.search-box {
  padding: 15px 20px;
  background: #ecf0f1;
  border-bottom: 1px solid #bdc3c7;
}
.search-box input {
  width: 100%;
  padding: 10px 15px;
  border: 1px solid #bdc3c7;
  border-radius: 6px;
  font-size: 14px;
}
.search-box input:focus {
  outline: none;
  border-color: #3498db;
}
table {
  width: 100%;
  border-collapse: collapse;
}
thead {
  background: #34495e;
  color: white;
  position: sticky;
  top: 0;
  z-index: 5;
}
th {
  padding: 12px 15px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  user-select: none;
}
th:hover {
  background: #2c3e50;
}
td {
  padding: 12px 15px;
  border-bottom: 1px solid #ecf0f1;
  font-size: 13px;
}
tbody tr:hover {
  background: #f8f9fa;
}
.study-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  color: white;
}
.status-active { color: #27ae60; font-weight: 600; }
.status-recruiting { color: #2ecc71; font-weight: 600; }
.status-terminated { color: #95a5a6; font-weight: 600; }
.status-withdrawn { color: #7f8c8d; font-weight: 600; }
</style>
</head>
<body class="login-mode">

<div id="loginBox">
  <h2>üíäü¶û Artiva Clinical Sites</h2>
  <p>Please enter credentials to view the dashboard</p>
  <input type="text" id="username" placeholder="Username" autocomplete="username">
  <input type="password" id="password" placeholder="Password" autocomplete="current-password">
  <button onclick="checkLogin()">Access Dashboard</button>
  <div id="error">Invalid username or password</div>
</div>

<div id="dashboard">
  <button id="logout" onclick="logout()">Logout</button>
  <button id="viewToggle">üìä Table View</button>
  <div id="header">
    <b>Artiva Biotherapeutics</b> ‚Äî Clinical Trial Sites &nbsp;|&nbsp;
    <b>7</b> Studies &nbsp;|&nbsp; <b>77</b> Sites &nbsp;|&nbsp; <b>9</b> Countries
  </div>
  <div id="tooltip"></div>
  <div id="legend">
    <h4>Studies</h4>
    <div class="legend-item"><span class="legend-color" style="background:#e74c3c"></span>AB-101 + B-Cell Depleting mAb (Lupus) [P1]</div>
    <div class="legend-item"><span class="legend-color" style="background:#9b59b6"></span>AB-201 HER2 (Withdrawn) [P1/2]</div>
    <div class="legend-item"><span class="legend-color" style="background:#3498db"></span>AB-101 Mono/Combo NHL [P1/2]</div>
    <div class="legend-item"><span class="legend-color" style="background:#2ecc71"></span>AB-101 Safety Study [P1]</div>
    <div class="legend-item"><span class="legend-color" style="background:#f39c12"></span>AB-101 Korea Autoimmune [P1]</div>
    <div class="legend-item"><span class="legend-color" style="background:#1abc9c"></span>AFM13 + AB-101 (Terminated) [P2]</div>
    <div class="legend-item"><span class="legend-color" style="background:#e67e22"></span>AlloNK Autoimmune [P2]</div>
  </div>
  <div id="map">
    <svg id="svg" viewBox="-180 -90 360 180"></svg>
  </div>
  
  <div id="tableView">
    <div class="table-container">
      <div class="table-header">Clinical Trial Sites - Data View</div>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search by facility, city, country, study, or NCT number..." onkeyup="filterTable()">
      </div>
      <table id="sitesTable">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Facility</th>
            <th onclick="sortTable(1)">City</th>
            <th onclick="sortTable(2)">State</th>
            <th onclick="sortTable(3)">Country</th>
            <th onclick="sortTable(4)">Study</th>
            <th onclick="sortTable(5)">NCT Number</th>
            <th onclick="sortTable(6)">Status</th>
          </tr>
        </thead>
        <tbody id="sitesTableBody">
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
const VALID_USER = 'artiva';
const VALID_PASS = '2024coolestipo!';

// Check if already logged in
if (sessionStorage.getItem('artiva_auth') === 'true') {
  showDashboard();
}

document.getElementById('password')?.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') checkLogin();
});

function checkLogin() {
  const user = document.getElementById('username').value.trim().toLowerCase();
  const pass = document.getElementById('password').value;
  
  if (user === VALID_USER && pass === VALID_PASS) {
    sessionStorage.setItem('artiva_auth', 'true');
    showDashboard();
  } else {
    document.getElementById('error').style.display = 'block';
    document.getElementById('password').value = '';
  }
}

function showDashboard() {
  document.body.className = 'dashboard-mode';
  loadDashboard();
  populateTable();
  
  // Bind toggle view button
  document.getElementById('viewToggle').addEventListener('click', toggleView);
}

function logout() {
  sessionStorage.removeItem('artiva_auth');
  document.body.className = 'login-mode';
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
  document.getElementById('error').style.display = 'none';
}

var sites = [{"lat": 33.52066, "lon": -86.80249, "facility": "Artiva Investigational Site Birmingham", "city": "Birmingham", "state": "Alabama", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 32.22174, "lon": -110.92648, "facility": "Artiva Investigational Site Tucson", "city": "Tucson", "state": "Arizona", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 32.71571, "lon": -117.16472, "facility": "Artiva Investigational Site San Diego", "city": "San Diego", "state": "California", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 25.95648, "lon": -80.13921, "facility": "Artiva Investigational Site Aventura", "city": "Aventura", "state": "Florida", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 26.13421, "lon": -80.23184, "facility": "Artiva Investigational Site Plantation", "city": "Plantation", "state": "Florida", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 41.66113, "lon": -91.53017, "facility": "Artiva Investigational Site Iowa", "city": "Iowa City", "state": "Iowa", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 35.22709, "lon": -80.84313, "facility": "Artiva Investigational Site Charlotte", "city": "Charlotte", "state": "North Carolina", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 32.7668, "lon": -96.59916, "facility": "Artiva Investigational Site Mesquite", "city": "Mesquite", "state": "Texas", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 30.15799, "lon": -95.48938, "facility": "Artiva Investigational Site Woodlands", "city": "The Woodlands", "state": "Texas", "country": "United States", "nct": "NCT06265220", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#e74c3c", "title": "AB-101 + B-Cell Depleting mAb (Lupus) [P1]"}, {"lat": 45.52345, "lon": -122.67621, "facility": "Oregon Health Science University (OHSU)", "city": "Portland", "state": "Oregon", "country": "United States", "nct": "NCT05678205", "status": "WITHDRAWN", "site_status": "", "color": "#9b59b6", "title": "AB-201 HER2 (Withdrawn) [P1/2]"}, {"lat": 37.29111, "lon": 127.00889, "facility": "The Catholic University of Korea, St. Vincent's Hospital", "city": "Suwon", "state": "Gyeonggi-do", "country": "South Korea", "nct": "NCT05678205", "status": "WITHDRAWN", "site_status": "", "color": "#9b59b6", "title": "AB-201 HER2 (Withdrawn) [P1/2]"}, {"lat": 33.52066, "lon": -86.80249, "facility": "Artiva Clinical Trial Site", "city": "Birmingham", "state": "Alabama", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 32.22174, "lon": -110.92648, "facility": "Artiva Clinical Trial Site", "city": "Tucson", "state": "Arizona", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 33.78779, "lon": -117.85311, "facility": "Artiva Clinical Trial Site", "city": "Orange", "state": "California", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 32.71571, "lon": -117.16472, "facility": "Artiva Clinical Trial Site", "city": "San Diego", "state": "California", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 29.65163, "lon": -82.32483, "facility": "Artiva Clinical Trial Site", "city": "Gainesville", "state": "Florida", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 33.749, "lon": -84.38798, "facility": "Artiva Clinical Trial Site", "city": "Atlanta", "state": "Georgia", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 41.85003, "lon": -87.65005, "facility": "Artiva Clinical Trial Site", "city": "Chicago", "state": "Illinois", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 41.66113, "lon": -91.53017, "facility": "Artiva Clinical Trial Site", "city": "Iowa City", "state": "Iowa", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 37.69224, "lon": -97.33754, "facility": "Artiva Clinical Trial Site", "city": "Wichita", "state": "Kansas", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 38.25424, "lon": -85.75941, "facility": "Artiva Clinical Trial Site", "city": "Louisville", "state": "Kentucky", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 42.33143, "lon": -83.04575, "facility": "Artiva Clinical Trial Site", "city": "Detroit", "state": "Michigan", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 40.77066, "lon": -73.71763, "facility": "Artiva Clinical Trial Site", "city": "Lake Success", "state": "New York", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 40.71427, "lon": -74.00597, "facility": "Artiva Clinical Trial Site", "city": "New York", "state": "New York", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 39.96118, "lon": -82.99879, "facility": "Artiva Clinical Trial Site", "city": "Columbus", "state": "Ohio", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 45.52345, "lon": -122.67621, "facility": "Artiva Clinical Trial Site", "city": "Portland", "state": "Oregon", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 39.95238, "lon": -75.16362, "facility": "Artiva Clinical Trial Site", "city": "Philadelphia", "state": "Pennsylvania", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 39.95238, "lon": -75.16362, "facility": "Artiva Clinical Trial Site", "city": "Philadelphia", "state": "Pennsylvania", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 41.82399, "lon": -71.41283, "facility": "Artiva Clinical Trial Site", "city": "Providence", "state": "Rhode Island", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 32.78306, "lon": -96.80667, "facility": "Artiva Clinical Trial Site", "city": "Dallas", "state": "Texas", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 40.76078, "lon": -111.89105, "facility": "Artiva Clinical Trial Site", "city": "Salt Lake City", "state": "Utah", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 37.55376, "lon": -77.46026, "facility": "Artiva Clinical Trial Site", "city": "Richmond", "state": "Virginia", "country": "United States", "nct": "NCT04673617", "status": "ACTIVE_NOT_RECRUITING", "site_status": "", "color": "#3498db", "title": "AB-101 Mono/Combo NHL [P1/2]"}, {"lat": 26.13421, "lon": -80.23184, "facility": "IRIS Research and Development, LLC", "city": "Plantation", "state": "Florida", "country": "United States", "nct": "NCT06581562", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#2ecc71", "title": "AB-101 Safety Study [P1]"}, {"lat": 37.566, "lon": 126.9784, "facility": "Seoul National University Hosptial", "city": "Seoul", "state": "", "country": "South Korea", "nct": "NCT06699771", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#f39c12", "title": "AB-101 Korea Autoimmune [P1]"}, {"lat": 37.566, "lon": 126.9784, "facility": "Asan Medical Center", "city": "Seoul", "state": "", "country": "South Korea", "nct": "NCT06699771", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#f39c12", "title": "AB-101 Korea Autoimmune [P1]"}, {"lat": 37.566, "lon": 126.9784, "facility": "Samsung Medical Center", "city": "Seoul", "state": "", "country": "South Korea", "nct": "NCT06699771", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#f39c12", "title": "AB-101 Korea Autoimmune [P1]"}, {"lat": 33.52066, "lon": -86.80249, "facility": "O'Neal Comprehensive Cancer Center at UAB", "city": "Birmingham", "state": "Alabama", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 34.13945, "lon": -117.97729, "facility": "City of Hope National Medical Center", "city": "Duarte", "state": "California", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 33.78779, "lon": -117.85311, "facility": "UC Irvine Health", "city": "Orange", "state": "California", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 39.73915, "lon": -104.9847, "facility": "Sarah Cannon Research Institute", "city": "Denver", "state": "Colorado", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 38.25424, "lon": -85.75941, "facility": "Norton Cancer Institute", "city": "Louisville", "state": "Kentucky", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 42.35843, "lon": -71.05977, "facility": "Beth Israel Deaconess Medical", "city": "Boston", "state": "Massachusetts", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 42.33143, "lon": -83.04575, "facility": "Karmanos Cancer Institute", "city": "Detroit", "state": "Michigan", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 44.97997, "lon": -93.26384, "facility": "Masonic Cancer Center, University of Minnesota", "city": "Minneapolis", "state": "Minnesota", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 38.62727, "lon": -90.19789, "facility": "Washington University School of Medicine", "city": "St Louis", "state": "Missouri", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 40.88593, "lon": -74.04347, "facility": "John Theurer Cancer Center", "city": "Hackensack", "state": "New Jersey", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 40.71427, "lon": -74.00597, "facility": "Memorial Sloan Kettering Cancer Center", "city": "New York", "state": "New York", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 35.9132, "lon": -79.05584, "facility": "UNC Immunotherapy Team, University of North Carolina at Chapel Hill", "city": "Chapel Hill", "state": "North Carolina", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 41.4995, "lon": -81.69541, "facility": "Cleveland Clinic", "city": "Cleveland", "state": "Ohio", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 39.95238, "lon": -75.16362, "facility": "University of Pennsylvania, Abramson Cancer Center", "city": "Philadelphia", "state": "Pennsylvania", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 39.95238, "lon": -75.16362, "facility": "Fox Chase Cancer Center", "city": "Philadelphia", "state": "Pennsylvania", "country": "United States", "nct": "NCT05883449", "status": "TERMINATED", "site_status": "", "color": "#1abc9c", "title": "AFM13 + AB-101 (Terminated) [P2]"}, {"lat": 33.20984, "lon": -87.56917, "facility": "Artiva Investigational Site Tuscaloosa", "city": "Tuscaloosa", "state": "Alabama", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 33.44838, "lon": -112.07404, "facility": "Artiva Investigational Site Phoenix", "city": "Phoenix", "state": "Arizona", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 34.09001, "lon": -117.89034, "facility": "Artiva Investigational Site Covina", "city": "Covina", "state": "California", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 33.80307, "lon": -118.07256, "facility": "Artiva Investigational Site Los Alamitos", "city": "Los Alamitos", "state": "California", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 25.95648, "lon": -80.13921, "facility": "Artiva Investigational Site Aventura", "city": "Aventura", "state": "Florida", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 26.93422, "lon": -80.09421, "facility": "Artiva Investigational Site Jupiter", "city": "Jupiter", "state": "Florida", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 26.13421, "lon": -80.23184, "facility": "Artiva Investigational Site Plantation", "city": "Plantation", "state": "Florida", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 41.76975, "lon": -87.93589, "facility": "Artiva Investigational Site Willowbrook", "city": "Willowbrook", "state": "Illinois", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 41.66113, "lon": -91.53017, "facility": "Artiva Investigational Site Iowa", "city": "Iowa City", "state": "Iowa", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 35.22709, "lon": -80.84313, "facility": "Artiva Investigational Site Charlotte", "city": "Charlotte", "state": "North Carolina", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 35.22709, "lon": -80.84313, "facility": "Artiva Investigational Site Charlotte", "city": "Charlotte", "state": "North Carolina", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 35.14063, "lon": -85.23273, "facility": "Artiva Investigational Site Hixson", "city": "Hixson", "state": "Tennessee", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 32.73569, "lon": -97.10807, "facility": "Artiva Investigational Site Arlington", "city": "Arlington", "state": "Texas", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 29.78579, "lon": -95.8244, "facility": "Artiva Investigational Site Katy", "city": "Katy", "state": "Texas", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 32.7668, "lon": -96.59916, "facility": "Artiva Investigational Site Mesquite", "city": "Mesquite", "state": "Texas", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 31.13129, "lon": -97.48946, "facility": "Artiva Investigational Site Woodland", "city": "Woodland", "state": "Texas", "country": "United States", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 42.69751, "lon": 23.32415, "facility": "Artiva Investigational Site Sofia", "city": "Sofia", "state": "", "country": "Bulgaria", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 43.29695, "lon": 5.38107, "facility": "Artiva Investigational Site Marseille", "city": "Marseille", "state": "", "country": "France", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 43.61093, "lon": 3.87635, "facility": "Artiva Investigational Site Montpellier", "city": "Montpellier", "state": "", "country": "France", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 43.60426, "lon": 1.44367, "facility": "Artiva Investigational Site Toulouse", "city": "Toulouse", "state": "", "country": "France", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 51.60698, "lon": 13.31243, "facility": "Artiva Investigational Site Munchen", "city": "M√ºnchen", "state": "", "country": "Germany", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 45.53558, "lon": 10.21472, "facility": "Artiva Investigational Site Brescia", "city": "Brescia", "state": "", "country": "Italy", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 41.12401, "lon": -8.61241, "facility": "Artiva Investigational Site Vila Nova De Gaia", "city": "Vila Nova de Gaia", "state": "", "country": "Portugal", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 44.43225, "lon": 26.10626, "facility": "Artiva Investigational Site Bucuresti", "city": "Bucharest", "state": "", "country": "Romania", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 44.43225, "lon": 26.10626, "facility": "Artiva Investigational Site Bucharest", "city": "Bucharest", "state": "", "country": "Romania", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}, {"lat": 37.38283, "lon": -5.97317, "facility": "Artiva Investigational Site Sevila", "city": "Seville", "state": "", "country": "Spain", "nct": "NCT06991114", "status": "RECRUITING", "site_status": "RECRUITING", "color": "#e67e22", "title": "AlloNK Autoimmune [P2]"}];

function loadDashboard() {
  var svg = document.getElementById('svg');
  
  fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/land-110m.json')
  .then(r => r.json())
  .then(topo => {
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/topojson-client@3';
    script.onload = function() {
      var land = topojson.feature(topo, topo.objects.land);
      land.features.forEach(function(f) {
        var coords = f.geometry.type === 'MultiPolygon' ? f.geometry.coordinates : [f.geometry.coordinates];
        coords.forEach(function(poly) {
          poly.forEach(function(ring) {
            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            var d = 'M' + ring.map(function(p) { return p[0] + ',' + (-p[1]); }).join('L') + 'Z';
            path.setAttribute('d', d);
            path.setAttribute('class', 'land');
            svg.appendChild(path);
          });
        });
      });
      drawSites();
    };
    document.head.appendChild(script);
  })
  .catch(function() { drawSites(); });
}

function drawSites() {
  var svg = document.getElementById('svg');
  var tooltip = document.getElementById('tooltip');
  sites.forEach(function(s) {
    var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', s.lon);
    circle.setAttribute('cy', -s.lat);
    circle.setAttribute('r', 1.5);
    circle.setAttribute('fill', s.color);
    circle.setAttribute('stroke', '#fff');
    circle.setAttribute('stroke-width', '0.3');
    circle.setAttribute('class', 'site');
    circle.addEventListener('mouseover', function(e) {
      tooltip.innerHTML = '<b>' + s.facility + '</b><br>' + s.city + (s.state ? ', '+s.state : '') + ', ' + s.country +
        '<br><br><b>' + s.title + '</b><br>NCT: ' + s.nct + '<br>Status: ' + s.status;
      tooltip.style.display = 'block';
    });
    circle.addEventListener('mousemove', function(e) {
      tooltip.style.left = (e.clientX + 15) + 'px';
      tooltip.style.top = (e.clientY - 10) + 'px';
    });
    circle.addEventListener('mouseout', function() { tooltip.style.display = 'none'; });
    svg.appendChild(circle);
  });
}

// Table view functions
let currentView = 'map';

function toggleView() {
  console.log('Toggle view clicked, current:', currentView);
  const mapDiv = document.getElementById('map');
  const tableDiv = document.getElementById('tableView');
  const legendDiv = document.getElementById('legend');
  const toggleBtn = document.getElementById('viewToggle');
  
  if (!mapDiv || !tableDiv || !legendDiv || !toggleBtn) {
    console.error('Missing elements:', { mapDiv, tableDiv, legendDiv, toggleBtn });
    return;
  }
  
  if (currentView === 'map') {
    mapDiv.classList.add('hidden');
    legendDiv.classList.add('hidden');
    tableDiv.classList.add('active');
    toggleBtn.textContent = 'üó∫Ô∏è Map View';
    currentView = 'table';
  } else {
    mapDiv.classList.remove('hidden');
    legendDiv.classList.remove('hidden');
    tableDiv.classList.remove('active');
    toggleBtn.textContent = 'üìä Table View';
    currentView = 'map';
  }
  console.log('Toggle complete, new view:', currentView);
}

function populateTable() {
  const tbody = document.getElementById('sitesTableBody');
  tbody.innerHTML = '';
  
  sites.forEach(function(site) {
    const row = tbody.insertRow();
    row.insertCell(0).textContent = site.facility;
    row.insertCell(1).textContent = site.city;
    row.insertCell(2).textContent = site.state || '‚Äî';
    row.insertCell(3).textContent = site.country;
    
    const studyCell = row.insertCell(4);
    const badge = document.createElement('span');
    badge.className = 'study-badge';
    badge.style.background = site.color;
    badge.textContent = site.title;
    studyCell.appendChild(badge);
    
    row.insertCell(5).textContent = site.nct;
    
    const statusCell = row.insertCell(6);
    statusCell.textContent = site.status.replace(/_/g, ' ');
    if (site.status.includes('ACTIVE')) statusCell.className = 'status-active';
    else if (site.status.includes('RECRUITING')) statusCell.className = 'status-recruiting';
    else if (site.status.includes('TERMINATED')) statusCell.className = 'status-terminated';
    else if (site.status.includes('WITHDRAWN')) statusCell.className = 'status-withdrawn';
  });
}

function filterTable() {
  const input = document.getElementById('searchInput');
  const filter = input.value.toLowerCase();
  const table = document.getElementById('sitesTable');
  const tr = table.getElementsByTagName('tr');
  
  for (let i = 1; i < tr.length; i++) {
    const row = tr[i];
    const text = row.textContent.toLowerCase();
    if (text.indexOf(filter) > -1) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  }
}

let sortDirection = {};

function sortTable(columnIndex) {
  const table = document.getElementById('sitesTable');
  const tbody = table.getElementsByTagName('tbody')[0];
  const rows = Array.from(tbody.getElementsByTagName('tr'));
  
  const direction = sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
  sortDirection[columnIndex] = direction;
  
  rows.sort(function(a, b) {
    const aText = a.cells[columnIndex].textContent.trim();
    const bText = b.cells[columnIndex].textContent.trim();
    
    if (direction === 'asc') {
      return aText.localeCompare(bText);
    } else {
      return bText.localeCompare(aText);
    }
  });
  
  rows.forEach(function(row) {
    tbody.appendChild(row);
  });
}
</script>
</body>
</html>
